<div ngClass="container">

    <mat-divider></mat-divider>

    <div fxLayout="row" fxLayoutAlign="space-between start">

        <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="10px">
            <mat-form-field>
                <input matInput [matDatepicker]="startDate" placeholder="Дата начала" [formControl]="pickerStartDate">
                <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
                <mat-datepicker #startDate></mat-datepicker>
            </mat-form-field>

            <mat-form-field>
                <input matInput [matDatepicker]="endDate" placeholder="Дата окончания" [formControl]="pickerEndDate"
                       (dateInput)="catchEndDatePickerEvent('input', $event)"
                       (dateChange)="catchEndDatePickerEvent('change', $event)">
                <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
                <mat-datepicker #endDate></mat-datepicker>
            </mat-form-field>

            <button mat-raised-button color="primary" (click)="getData()"
                    matTooltip="Загрузка данных за указанную дату">
                Загрузка
            </button>
            <span class="example-spacer"></span>
            <button mat-raised-button color="primary" (click)="toTransitSelected()" matBadge="{{selectedItems}}"
                    matBadgePosition="before" matBadgeColor="accent" [matBadgeHidden]="!isBadgeVisible"
                    matTooltip="Выделенные на транзитный счёт">Транзит
            </button>
        </div>

        <div fxLayout="row" fxLayoutAlign="end start" fxLayoutGap="10px">
            <mat-form-field>
                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Поиск">
                <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
        </div>

    </div>

    <mat-progress-bar mode="indeterminate" *ngIf="isWait"></mat-progress-bar>

    <table mat-table [dataSource]="dataSource" matSort>

        <ng-container matColumnDef="ID">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.id}}</td>
        </ng-container>

        <ng-container matColumnDef="nameSender">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Отправитель</th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.nameSender}}</td>
        </ng-container>

        <ng-container matColumnDef="sum">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Сумма</th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.sum}}</td>
        </ng-container>

        <ng-container matColumnDef="rnnSender">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ИИН</th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.rnnSender}}</td>
        </ng-container>

        <ng-container matColumnDef="accountSender">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Банковский счет
            </th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.accountSender}}
            </td>
        </ng-container>

        <ng-container matColumnDef="knp">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>КНП</th>
            <td mat-cell *matCellDef="let paymentRow"> {{paymentRow.knp}}</td>
        </ng-container>

        <ng-container matColumnDef="paymentDetails">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Назначение
                платежа
            </th>
            <td mat-cell *matCellDef="let paymentRow">
                {{paymentRow.paymentDetails | paymentDetailsPipe: paymentRow.paymentDetails | slice : 0 :
                shrinkDetailsColumnSize }}
            </td>
        </ng-container>

        <ng-container matColumnDef="statusRu">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Статус</th>
            <!--<td mat-cell *matCellDef="let paymentRow"> {{ paymentRow.status | paymentStatusRuPipe: paymentRow.status }} -->
            <td mat-cell *matCellDef="let paymentRow"> {{ paymentRow.statusRu}}
            </td>
        </ng-container>

        <ng-container matColumnDef="managers">
            <th mat-header-cell *matHeaderCellDef mat-sort-header ngClass="mat-column-managers">Менеджер</th>
            <td mat-cell *matCellDef="let paymentRow" ngClass="mat-column-managers"> {{paymentRow.managers}}</td>
        </ng-container>

        <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox (change)="$event ? masterToggle() : null"
                              [checked]="selection.hasValue() && isAllSelected()"
                              [indeterminate]="selection.hasValue() && !isAllSelected()">
                </mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let paymentRow">
                <mat-checkbox (click)="$event.stopPropagation()"
                              (change)="$event ? processForSelect(paymentRow) : null"
                              [checked]="selection.isSelected(paymentRow)">
                </mat-checkbox>
            </td>
        </ng-container>

        <ng-container matColumnDef="rowMenu">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let paymentRow">
                <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="Действия над платежом">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item
                            [disabled]="(paymentRow.status == 6 || paymentRow.status == 7 || paymentRow.status == 1)"
                            (click)="menuOnRowToTransit(paymentRow)">
                        <!--<mat-icon>dialpad</mat-icon>-->
                        <span>На транзит</span>
                    </button>
                    <button mat-menu-item [disabled]="!(paymentRow.status == 6)"
                            (click)="menuOnRowDeleteTransit(paymentRow)">
                        <span>Удалить с транзита</span>
                    </button>
                    <button mat-menu-item (click)="menuOnRowDistributeEquipment(paymentRow)"
                            [disabled]="!(paymentRow.status == 0 || paymentRow.status == 2 || paymentRow.status == 9 || paymentRow.status == 8)">
                        <span>Разнести</span>
                    </button>
                    <button mat-menu-item [disabled]="!(paymentRow.status == 6)">
                        <span>Разнести с транзитного счёта</span>
                    </button>
                    <button mat-menu-item [disabled]>
                        <span>Отменить</span>
                    </button>
                </mat-menu>
            </td>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>

        <!-- you can add to signature of mat-row for catch click on hole row: (click)="onRowClicked(paymentRow)"-->
        <!-- for Highlight: paymentRowHighlight [paymentStatus]="paymentRow.getStatus()"-->
        <mat-row *matRowDef="let paymentRow; columns: displayedColumns;"
                 [ngClass]="{'row_highlight': paymentRow.status == 1 || paymentRow.status == 7 }"
                 (click)="onRowClicked(paymentRow)"></mat-row>

    </table>
    <!-- SPINNER
        <mat-card *ngIf="isLoading" style="display: flex; justify-content: center; align-items: center">
            <mat-progress-spinner
                    color="primary"
                    mode="indeterminate">
            </mat-progress-spinner>
        </mat-card>
        -->

    <mat-paginator [length]="!paginatorResultsLength" [pageSize]="30"></mat-paginator>

</div>